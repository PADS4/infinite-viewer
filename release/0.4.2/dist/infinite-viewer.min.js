/*
Copyright (c) 2019 Daybrush
name: infinite-viewer
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/infinite-viewer.git
version: 0.4.2
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).InfiniteViewer=n()}(this,function(){"use strict";var c=function(t,n){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)};var l=function(){return(l=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function a(t){return void 0===t}var t=function(){var t=function(){function t(){this._eventHandler={},this.options={}}var n=t.prototype;return n.trigger=function(t,n){void 0===n&&(n={});var i=this._eventHandler[t]||[];if(!(0<i.length))return!0;i=i.concat(),n.eventType=t;var e=!1,r=[n],o=0;n.stop=function(){e=!0},n.currentTarget=this;for(var s=arguments.length,a=new Array(2<s?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];for(1<=a.length&&(r=r.concat(a)),o=0;i[o];o++)i[o].apply(this,r);return!e},n.once=function(r,o){if("object"==typeof r&&a(o)){var t,n=r;for(t in n)this.once(t,n[t]);return this}if("string"==typeof r&&"function"==typeof o){var s=this;this.on(r,function t(){for(var n=arguments.length,i=new Array(n),e=0;e<n;e++)i[e]=arguments[e];o.apply(s,i),s.off(r,t)})}return this},n.hasOn=function(t){return!!this._eventHandler[t]},n.on=function(t,n){if("object"==typeof t&&a(n)){var i,e=t;for(i in e)this.on(i,e[i]);return this}if("string"==typeof t&&"function"==typeof n){var r=this._eventHandler[t];a(r)&&(this._eventHandler[t]=[],r=this._eventHandler[t]),r.push(n)}return this},n.off=function(t,n){if(a(t))return this._eventHandler={},this;if(a(n)){if("string"==typeof t)return this._eventHandler[t]=void 0,this;var i,e=t;for(i in e)this.off(i,e[i]);return this}var r,o,s=this._eventHandler[t];if(s)for(r=0;void 0!==(o=s[r]);r++)if(o===n){s=s.splice(r,1);break}return this},t}();return t.VERSION="2.1.2",t}(),h=['"',"'",'\\"',"\\'"];function u(t,n,i,e){for(var r=i;r<e;++r){var o=n[r].trim();if(o===t)return r;var s=r;if("("===o?s=u(")",n,r+1,e):-1<h.indexOf(o)&&(s=u(o,n,r+1,e)),-1===s)break;r=s}return-1}function f(t){return function(t,n){for(var i=new RegExp("(\\s*"+(n||",")+"\\s*|\\(|\\)|\"|'|\\\\\"|\\\\'|\\s+)","g"),e=t.split(i).filter(Boolean),r=e.length,o=[],s=[],a=0;a<r;++a){var c=e[a].trim(),l=a;if("("===c)l=u(")",e,a+1,r);else{if(")"===c)throw new Error("invalid format");if(-1<h.indexOf(c))l=u(c,e,a+1,r);else if(c===n){s.length&&(o.push(s.join("")),s=[]);continue}}-1===l&&(l=r-1),s.push(e.slice(a,l+1).join("")),a=l}return s.length&&o.push(s.join("")),o}(t,",")}function p(t,n,i,e){t.addEventListener(n,i,e)}function g(t,n,i){t.removeEventListener(n,i)}var v=function(){return(v=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function d(t,n,i,e){var r=Y(t),o=Y(n),s=Y(e);return y(T(e[0],X(r,s)),T(e[0],X(o,s)),i[0])}function m(t){return t.touches?C(t.touches):[r(t)]}function y(t,n,i){var e=t.clientX,r=t.clientY;return{clientX:e,clientY:r,deltaX:e-n.clientX,deltaY:r-n.clientY,distX:e-i.clientX,distY:r-i.clientY}}function D(t){return Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))}function E(t,i,e){return t.map(function(t,n){return y(t,i[n],e[n])})}function C(t){for(var n=Math.min(t.length,2),i=[],e=0;e<n;++e)i.push(r(t[e]));return i}function r(t){return{clientX:t.clientX,clientY:t.clientY}}function Y(t){return 1===t.length?t[0]:{clientX:(t[0].clientX+t[1].clientX)/2,clientY:(t[0].clientY+t[1].clientY)/2}}function T(t,n){return{clientX:t.clientX+n.clientX,clientY:t.clientY+n.clientY}}function X(t,n){return{clientX:t.clientX-n.clientX,clientY:t.clientY-n.clientY}}var S=function(){function t(t,n){var h=this;void 0===n&&(n={}),this.options={},this.flag=!1,this.pinchFlag=!1,this.datas={},this.isDrag=!1,this.isPinch=!1,this.isMouse=!1,this.isTouch=!1,this.prevClients=[],this.startClients=[],this.movement=0,this.startPinchClients=[],this.startDistance=0,this.customDist=[0,0],this.targets=[],this.onDragStart=function(t){if(h.flag||!1!==t.cancelable){var n,i=h.options,e=i.container,r=i.pinchOutside,o=i.dragstart,s=i.preventRightClick,a=h.isTouch;if(!h.flag&&a&&r&&setTimeout(function(){p(e,"touchstart",h.onDragStart)}),h.flag&&a&&r&&g(e,"touchstart",h.onDragStart),(n=t).touches&&2<=n.touches.length){if(!h.flag&&t.touches.length!==t.changedTouches.length)return;h.pinchFlag||h.onPinchStart(t)}if(!h.flag){var c=h.startClients[0]?h.startClients:m(t);h.customDist=[0,0],h.flag=!0,h.isDrag=!1,h.startClients=c,h.prevClients=c,h.datas={};var l=y(c[h.movement=0],h.prevClients[0],h.startClients[0]);(s&&3===t.which||!1===(o&&o(v({type:"dragstart",datas:h.datas,inputEvent:t},l))))&&(h.startClients=[],h.prevClients=[],h.flag=!1),h.flag&&t.preventDefault()}}},this.onDrag=function(t,n){if(h.flag){var i=m(t);h.pinchFlag&&h.onPinch(t,i);var e=h.move([0,0],t,i);if(e&&(e.deltaX||e.deltaY)){var r=h.options.drag;r&&r(v({},e,{isScroll:!!n,inputEvent:t}))}}},this.onDragEnd=function(t){if(h.flag){var n=h.options,i=n.dragend,e=n.pinchOutside,r=n.container;h.isTouch&&e&&g(r,"touchstart",h.onDragStart),h.pinchFlag&&h.onPinchEnd(t),h.flag=!1;var o=h.prevClients,s=h.startClients,a=h.pinchFlag?d(o,o,s,h.startPinchClients):y(o[0],o[0],s[0]);h.startClients=[],h.prevClients=[],i&&i(v({type:"dragend",datas:h.datas,isDrag:h.isDrag,inputEvent:t},a))}};var i=[].concat(t);this.options=v({container:1<i.length?window:i[0],preventRightClick:!0,preventDefault:!0,pinchThreshold:0,events:["touch","mouse"]},n);var e=this.options,r=e.container,o=e.events;if(this.isTouch=-1<o.indexOf("touch"),this.isMouse=-1<o.indexOf("mouse"),this.customDist=[0,0],this.targets=i,this.isMouse&&(i.forEach(function(t){p(t,"mousedown",h.onDragStart)}),p(r,"mousemove",this.onDrag),p(r,"mouseup",this.onDragEnd)),this.isTouch){var s={passive:!1};i.forEach(function(t){p(t,"touchstart",h.onDragStart,s)}),p(r,"touchmove",this.onDrag,s),p(r,"touchend",this.onDragEnd,s),p(r,"touchcancel",this.onDragEnd,s)}}var n=t.prototype;return n.isDragging=function(){return this.isDrag},n.isFlag=function(){return this.flag},n.isPinchFlag=function(){return this.pinchFlag},n.isPinching=function(){return this.isPinch},n.scrollBy=function(n,i,t,e){void 0===e&&(e=!0),this.flag&&(this.startClients.forEach(function(t){t.clientX-=n,t.clientY-=i}),this.prevClients.forEach(function(t){t.clientX-=n,t.clientY-=i}),e&&this.onDrag(t,!0))},n.move=function(t,n,i){var e=t[0],r=t[1];void 0===i&&(i=this.prevClients);var o=this.customDist,s=this.prevClients,a=this.startClients,c=this.pinchFlag?d(i,s,a,this.startPinchClients):y(i[0],s[0],a[0]);o[0]+=e,o[1]+=r,c.deltaX+=e,c.deltaY+=r;var l=c.deltaX,h=c.deltaY;return c.distX+=o[0],c.distY+=o[1],this.movement+=Math.sqrt(l*l+h*h),this.prevClients=i,this.isDrag=!0,v({type:"drag",datas:this.datas},c,{movement:this.movement,isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,inputEvent:n})},n.onPinchStart=function(t){var n,i,e=this.options,r=e.pinchstart,o=e.pinchThreshold;if(!(this.isDrag&&this.movement>o)){var s=C(t.changedTouches);if(this.pinchFlag=!0,(n=this.startClients).push.apply(n,s),(i=this.prevClients).push.apply(i,s),this.startDistance=D(this.prevClients),this.startPinchClients=this.prevClients.slice(),r){var a=this.prevClients,c=Y(a),l=y(c,c,c);r(v({type:"pinchstart",datas:this.datas,touches:E(a,a,a)},l,{inputEvent:t}))}}},n.onPinch=function(t,n){if(this.flag&&this.pinchFlag&&!(n.length<2)){this.isPinch=!0;var i=this.options.pinch;if(i){var e=this.prevClients,r=this.startClients,o=y(Y(n),Y(e),Y(r)),s=D(n);i(v({type:"pinch",datas:this.datas,movement:this.movement,touches:E(n,e,r),scale:s/this.startDistance,distance:s},o,{inputEvent:t}))}}},n.onPinchEnd=function(t){if(this.flag&&this.pinchFlag){var n=this.isPinch;this.isPinch=!1,this.pinchFlag=!1;var i=this.options.pinchend;if(i){var e=this.prevClients,r=this.startClients,o=y(Y(e),Y(e),Y(r));i(v({type:"pinchend",datas:this.datas,isPinch:n,touches:E(e,e,r)},o,{inputEvent:t})),this.isPinch=!1,this.pinchFlag=!1}}},n.unset=function(){var n=this,t=this.targets,i=this.options.container;this.isMouse&&(t.forEach(function(t){g(t,"mousedown",n.onDragStart)}),g(i,"mousemove",this.onDrag),g(i,"mouseup",this.onDragEnd)),this.isTouch&&(t.forEach(function(t){g(t,"touchstart",n.onDragStart)}),g(i,"touchstart",this.onDragStart),g(i,"touchmove",this.onDrag),g(i,"touchend",this.onDragEnd),g(i,"touchcancel",this.onDragEnd))},t}();var P,b,w,O,A=(w="rCS"+function(t){for(var n=5381,i=t.length;i;)n=33*n^t.charCodeAt(--i);return n>>>0}(P="\n{\n    position: relative;\n    display: block;\n    overflow: auto;\n}\n:host::-webkit-scrollbar {\n    display: none;\n}\n").toString(36),O=0,{className:w,inject:function(t){var n,i,e,r,o,s=function(t){if(t.getRootNode){var n=t.getRootNode();if(11===n.nodeType)return n}}(t),a=0===O;return(s||a)&&(i=w,e=P,r=s,(o=document.createElement("style")).setAttribute("type","text/css"),o.innerHTML=e.replace(/([^}{]*){/gm,function(t,n){return f(n).map(function(t){return-1<t.indexOf(":global")?t.replace(/\:global/g,""):-1<t.indexOf(":host")?""+t.replace(/\:host/g,"."+i):"."+i+" "+t}).join(", ")+"{"}),(r||document.head||document.body).appendChild(o),n=o),a&&(b=n),s||++O,{destroy:function(){s?(t.removeChild(n),n=null):(0<O&&--O,0===O&&b&&(b.parentNode.removeChild(b),b=null))}}}}),_=A.className,j=["margin","threshold","zoom","rangeX","rangeY","usePinch","pinchThreshold"],n=function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;var e=Array(t),r=0;for(n=0;n<i;n++)for(var o=arguments[n],s=0,a=o.length;s<a;s++,r++)e[r]=o[s];return e}(j,["scrollArea"]),i={margin:Number,threshold:Number,zoom:Number,scrollArea:Object,rangeX:Array,rangeY:Array,pinchThreshold:Number,usePinch:Boolean};function F(t,n){var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return Math.abs(i/n)}function L(t,n,i){return Math.min(i,Math.max(n,t))}var e=function(e){function t(){this.constructor=n}var n,i;function r(t,n,i){void 0===i&&(i={});var E=e.call(this)||this;return E.container=t,E.viewport=n,E.loopX=0,E.loopY=0,E.offsetX=0,E.offsetY=0,E.scrollLeft=0,E.scrollTop=0,E.timer=0,E.dragFlag=!1,E.onScroll=function(){var t=E.container,n=t.scrollLeft,i=t.scrollTop,e=E.margin,r=void 0===e?0:e,o=E.threshold,s=void 0===o?0:o,a=E.loopX,c=E.loopY,l=E.rangeX,h=void 0===l?[0,0]:l,u=E.rangeY,f=void 0===u?[0,0]:u,p=2*r-s,g=a,v=c,d=n,m=i;n<s?g>h[0]&&(d=n+r,--g):p<n&&g<h[1]&&(d=n-r,++g),i<s?v>f[0]&&(m=i+r,--v):p<i&&v<f[1]&&(m=i-r,++v);var y=E.scrollLeft!==d||E.scrollTop!==m,D=a!==g||c!==v;E.scrollLeft=d,E.scrollTop=m,E.loopX=g,E.loopY=v,E.render(),(D||y)&&E.trigger("scroll",{scrollLeft:E.getScrollLeft(),scrollTop:E.getScrollTop()}),y&&E.move(d,m)},E.options=l({margin:500,threshold:100,zoom:1,rangeX:[-1/0,1/0],rangeY:[-1/0,1/0],scrollArea:null,usePinch:!1,pinchThreshold:30},i),E.scrollArea=E.options.scrollArea,E.init(),E}c(n=r,i=e),n.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t);var o,s,a=r.prototype;return a.getContainer=function(){return this.container},a.getViewport=function(){return this.viewport},a.destroy=function(){this.off(),this.dragger.unset(),this.injectResult.destroy(),g(this.container,"scroll",this.onScroll),this.dragger=null,this.injectResult=null,this.container=null,this.options=null},a.getScrollTop=function(t){return(this.scrollTop+(this.loopY-1)*this.margin-this.offsetY+(t?(1-this.rangeY[0])*this.margin:0))/this.zoom},a.getScrollLeft=function(t){return(this.scrollLeft+(this.loopX-1)*this.margin-this.offsetX+(t?(1-this.rangeX[0])*this.margin:0))/this.zoom},a.getScrollWidth=function(){return this.container.offsetWidth+this.margin*(this.rangeX[1]-this.rangeX[0]+2)},a.getScrollHeight=function(){return this.container.offsetHeight+this.margin*(this.rangeY[1]-this.rangeY[0]+2)},a.scrollCenter=function(){var t=this.container,n=t.offsetWidth,i=t.offsetHeight,e=this.viewport,r=e.offsetWidth,o=e.offsetHeight,s=this.zoom,a=-(n-r*s)/2,c=-(i-o*s)/2;return this.scrollTo(a,c)},a.scrollBy=function(t,n){var i=this.zoom;return this.scrollTo(this.getScrollLeft()*i+t,this.getScrollTop()*i+n)},a.scrollTo=function(t,n){var i=this.rangeX,e=void 0===i?[0,0]:i,r=this.rangeY,o=void 0===r?[0,0]:r,s=this.margin,a=void 0===s?0:s;return this.loopX=L(Math.floor((a+t)/a),e[0],e[1]),this.loopY=L(Math.floor((a+n)/a),o[0],o[1]),this.offsetX=(this.loopX-1)*a-t+this.scrollLeft,this.offsetY=(this.loopY-1)*a-n+this.scrollTop,this.render(),this.trigger("scroll",{scrollLeft:this.getScrollLeft(),scrollTop:this.getScrollTop()}),this},a.setZoom=function(t){var n=this.viewport,i=n.offsetWidth,e=n.offsetHeight,r=t-this.zoom;this.options.zoom=t,this.scrollBy(i*r/2,e*r/2),this.render()},a.init=function(){var t,n,e=this,i=this.container;if(n=_,(t=i).classList?t.classList.add(n):t.className+=" "+n,!this.scrollArea){this.scrollArea=document.createElement("div");var r=this.scrollArea;r.style.cssText+="position:absolute;top:0;left:0;",i.insertBefore(r,i.firstChild)}this.injectResult=A.inject(i),this.dragger=new S(i,{container:document.body,events:["touch"],dragstart:function(t){var n=t.inputEvent;return n.preventDefault(),e.pauseAnimation(),e.dragFlag=!1,e.trigger("dragStart",{inputEvent:n})},drag:function(t){var n=e.options;!n.usePinch||t.isPinch?(e.trigger("drag",{inputEvent:t.inputEvent}),function(t){var n=t.deltaX,i=t.deltaY,e=t.datas,r=Date.now(),o=e.speed;if(!o)return e.speed=[0,0],e.time=r;var s=r-e.time;e.speed=[o[0]/2+n/s,o[1]/2+i/s]}(t),e.scrollBy(-t.deltaX,-t.deltaY)):!e.dragFlag&&t.movement>n.pinchThreshold&&(e.dragFlag=!0,e.trigger("abortPinch",{inputEvent:t.inputEvent}))},dragend:function(t){e.trigger("dragEnd",{isDrag:t.isDrag,inputEvent:t.inputEvent}),e.startAnimation(t.datas.speed)},pinchstart:function(t){var n=t.inputEvent,i=t.datas;n.preventDefault(),e.pauseAnimation(),i.startZoom=e.zoom},pinch:function(t){e.trigger("pinch",{distance:t.distance,scale:t.scale,zoom:t.datas.startZoom*t.scale,inputEvent:t.inputEvent})}});var o=this.margin;p(i,"scroll",this.onScroll),this.render(),this.move(o,o)},a.render=function(){var t=this,n=t.margin,i=void 0===n?0:n,e=t.loopX,r=t.loopY,o=t.offsetX,s=t.offsetY,a=t.zoom,c=void 0===a?1:a,l="calc(100% + "+2*i+"px)",h=(1-e)*i+o,u=(1-r)*i+s;this.scrollArea.style.cssText+="position:absolute;top:0;left:0;width:"+l+";height:"+l+";",this.viewport.style.cssText="transform-origin: 0 0;transform:translate("+h+"px, "+u+"px) scale("+c+");"},a.move=function(t,n){var i=this.container;i.scrollLeft=t,i.scrollTop=n},a.startAnimation=function(t){var r=this;if(t&&(t[0]||t[1])){var n,i,o=function(t){return 1-Math.pow(1-t,3)},s=F(t,-6e-4),a=(i=F(n=t,-6e-4),[n[0]/2*i,n[1]/2*i]),c=Date.now(),l=c,h=function(){var t=Date.now(),n=t-c;s<n&&(n=s);var i=o(n/s),e=o((l-c)/s);l=t,r.scrollBy(-a[0]*(i-e),-a[1]*(i-e)),s<=n||(r.timer=requestAnimationFrame(h))};this.timer=requestAnimationFrame(h)}},a.pauseAnimation=function(){cancelAnimationFrame(this.timer)},r=function(t,n,i,e){var r,o=arguments.length,s=o<3?n:null===e?e=Object.getOwnPropertyDescriptor(n,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,i,e);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(o<3?r(s):3<o?r(n,i,s):r(n,i))||s);return 3<o&&s&&Object.defineProperty(n,i,s),s}([(o=j,s=function(t,n){var i={enumerable:!0,configurable:!0,get:function(){return this.options[n]}},e=("set "+n).replace(/[\s-_]([a-z])/g,function(t,n){return n.toUpperCase()});t[e]?i.set=function(t){this[e](t)}:i.set=function(t){this.options[n]=t},Object.defineProperty(t,n,i)},function(t){var n=t.prototype;o.forEach(function(t){s(n,t)})})],r)}(t),o={__proto__:null,default:e,OPTIONS:n,OPTION_TYPES:i,PROPERTIES:j,EVENTS:["scroll","abortPinch","dragStart","dragEnd","pinch"],METHODS:["getScrollLeft","getScrollTop","getScrollWidth","getScrollHeight","scrollTo","scrollBy","scrollCenter","getContainer","getViewport"],CLASS_NAME:_};for(var s in o)e[s]=o[s];return e});
//# sourceMappingURL=infinite-viewer.min.js.map
