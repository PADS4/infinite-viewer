/*
Copyright (c) 2019 Daybrush
name: infinite-viewer
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/infinite-viewer.git
version: 0.0.2
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@egjs/component"),require("@daybrush/drag"),require("framework-utils"),require("@daybrush/utils"),require("css-styled")):"function"==typeof define&&define.amd?define(["@egjs/component","@daybrush/drag","framework-utils","@daybrush/utils","css-styled"],e):(t=t||self).InfiniteViewer=e(t.Component,t.Dragger,t.frameworkUtils,t.utils,t.styled)}(this,function(t,s,l,a,e){"use strict";var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};var u=function(){return(u=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};var f=e("\n{\n    position: relative;\n    display: block;\n    overflow: auto;\n}\n:host::-webkit-scrollbar {\n    display: none;\n}\n"),h=f.className,p=["margin","threshold","zoom"],o={margin:Number,threshold:Number,zoom:Number,scrollArea:Object};function d(t,e){var o=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return Math.abs(o/e)}var r=function(r){function t(){this.constructor=e}var e,o;function n(t,e,o){void 0===o&&(o={});var f=r.call(this)||this;return f.container=t,f.viewport=e,f.loopX=0,f.loopY=0,f.offsetX=0,f.offsetY=0,f.scrollLeft=0,f.scrollTop=0,f.timer=0,f.onScroll=function(){var t=f.container,e=t.scrollLeft,o=t.scrollTop,r=f.margin,n=f.threshold,i=2*r-n,s=f.loopX,l=f.loopY,a=e,c=o;e<n?(a=e+r,--s):i<e&&(a=e-r,++s),o<n?(c=o+r,--l):i<o&&(c=o-r,++l),f.scrollLeft=a,f.scrollTop=c,f.loopX=s,f.loopY=l,f.render(),f.trigger("scroll"),e===a&&o===c||f.move(a,c)},f.options=u({margin:500,threshold:100,zoom:1,scrollArea:null},o),f.scrollArea=f.options.scrollArea,f.init(),f}c(e=n,o=r),e.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t);var i=n.prototype;return i.destroy=function(){this.off(),this.dragger.unset(),this.injectResult.destroy(),a.removeEvent(this.container,"scroll",this.onScroll),this.dragger=null,this.injectResult=null,this.container=null,this.options=null},i.getScrollTop=function(){return this.scrollTop+(this.loopY-1)*this.margin-this.offsetY},i.getScrollLeft=function(){return this.scrollLeft+(this.loopX-1)*this.margin-this.offsetX},i.scrollBy=function(t,e){this.scrollTo(this.getScrollLeft()+t,this.getScrollTop()+e)},i.scrollTo=function(t,e){var o=this.margin;this.loopX=Math.floor((o+t)/o),this.loopY=Math.floor((o+e)/o),this.offsetX=(this.loopX-1)*o-t+this.scrollLeft,this.offsetY=(this.loopY-1)*o-e+this.scrollTop,this.render(),this.trigger("scroll")},i.init=function(){var e=this,t=this.container;if(a.addClass(t,h),!this.scrollArea){this.scrollArea=document.createElement("div");var o=this.scrollArea;o.style.cssText="position:absolute;top:0;left:0;width:calc(100% + 400px);height:calc(100% + 400px);",t.insertBefore(o,t.firstChild)}this.injectResult=f.inject(t),this.dragger=new s(t,{container:document.body,events:["touch"],dragstart:function(t){t.inputEvent.preventDefault(),e.pauseAnimation()},drag:function(t){!function(t){var e=t.deltaX,o=t.deltaY,r=t.datas,n=Date.now(),i=r.speed;if(!i)return r.speed=[0,0],r.time=n;var s=n-r.time;r.speed=[i[0]/2+e/s,i[1]/2+o/s]}(t),e.scrollBy(-t.deltaX,-t.deltaY)},dragend:function(t){e.startAnimation(t.datas.speed)}});var r=this.margin;a.addEvent(t,"scroll",this.onScroll),this.render(),this.move(r,r)},i.render=function(){var t=this,e=t.margin,o=t.loopX,r=t.loopY,n=t.offsetX,i=t.offsetY,s=t.zoom,l="calc(100% + "+2*e+"px)",a=(1-o)*e+n,c=(1-r)*e+i;this.scrollArea.style.cssText+="width:"+l+";height:"+l+";",this.viewport.style.transform="translate("+a+"px, "+c+"px) scale("+s+")"},i.move=function(t,e){var o=this.container;o.scrollLeft=t,o.scrollTop=e},i.startAnimation=function(t){var n=this;if(t&&(t[0]||t[1])){var e,o,i=function(t){return 1-Math.pow(1-t,3)},s=d(t,-6e-4),l=(o=d(e=t,-6e-4),[e[0]/2*o,e[1]/2*o]),a=Date.now(),c=a,f=function(){var t=Date.now(),e=t-a;s<e&&(e=s);var o=i(e/s),r=i((c-a)/s);c=t,n.scrollBy(-l[0]*(o-r),-l[1]*(o-r)),s<=e||(n.timer=requestAnimationFrame(f))};this.timer=requestAnimationFrame(f)}},i.pauseAnimation=function(){cancelAnimationFrame(this.timer)},n=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var l=t.length-1;0<=l;l--)(n=t[l])&&(s=(i<3?n(s):3<i?n(e,o,s):n(e,o))||s);return 3<i&&s&&Object.defineProperty(e,o,s),s}([l.Properties(p,function(t,e){var o={enumerable:!0,configurable:!0,get:function(){return this.options[e]}},r=a.camelize("set "+e);t[r]?o.set=function(t){this[r](t)}:o.set=function(t){this.options[e]=t},Object.defineProperty(t,e,o)})],n)}(t),n={__proto__:null,default:r,OPTIONS:["margin","threshold","zoom","scrollArea"],OPTION_TYPES:o,PROPERTIES:p,EVENTS:["scroll"],METHODS:["getScrollLeft","getScrollTop","scrollTo","scrollBy"],CLASS_NAME:h};for(var i in n)r[i]=n[i];return r});
//# sourceMappingURL=infinite-viewer.min.js.map
