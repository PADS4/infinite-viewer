/*
Copyright (c) 2019 Daybrush
name: infinite-viewer
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/infinite-viewer.git
version: 0.4.4
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).InfiniteViewer=n()}(this,function(){"use strict";var c=function(t,n){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)};var l=function(){return(l=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function a(t){return void 0===t}var t=function(){var t=function(){function t(){this._eventHandler={},this.options={}}var n=t.prototype;return n.trigger=function(t,n){void 0===n&&(n={});var i=this._eventHandler[t]||[];if(!(0<i.length))return!0;i=i.concat(),n.eventType=t;var e=!1,r=[n],o=0;n.stop=function(){e=!0},n.currentTarget=this;for(var s=arguments.length,a=new Array(2<s?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];for(1<=a.length&&(r=r.concat(a)),o=0;i[o];o++)i[o].apply(this,r);return!e},n.once=function(r,o){if("object"==typeof r&&a(o)){var t,n=r;for(t in n)this.once(t,n[t]);return this}if("string"==typeof r&&"function"==typeof o){var s=this;this.on(r,function t(){for(var n=arguments.length,i=new Array(n),e=0;e<n;e++)i[e]=arguments[e];o.apply(s,i),s.off(r,t)})}return this},n.hasOn=function(t){return!!this._eventHandler[t]},n.on=function(t,n){if("object"==typeof t&&a(n)){var i,e=t;for(i in e)this.on(i,e[i]);return this}if("string"==typeof t&&"function"==typeof n){var r=this._eventHandler[t];a(r)&&(this._eventHandler[t]=[],r=this._eventHandler[t]),r.push(n)}return this},n.off=function(t,n){if(a(t))return this._eventHandler={},this;if(a(n)){if("string"==typeof t)return this._eventHandler[t]=void 0,this;var i,e=t;for(i in e)this.off(i,e[i]);return this}var r,o,s=this._eventHandler[t];if(s)for(r=0;void 0!==(o=s[r]);r++)if(o===n){s=s.splice(r,1);break}return this},t}();return t.VERSION="2.1.2",t}(),h=['"',"'",'\\"',"\\'"];function u(t,n,i,e){for(var r=i;r<e;++r){var o=n[r].trim();if(o===t)return r;var s=r;if("("===o?s=u(")",n,r+1,e):-1<h.indexOf(o)&&(s=u(o,n,r+1,e)),-1===s)break;r=s}return-1}function f(t){return function(t,n){for(var i=new RegExp("(\\s*"+(n||",")+"\\s*|\\(|\\)|\"|'|\\\\\"|\\\\'|\\s+)","g"),e=t.split(i).filter(Boolean),r=e.length,o=[],s=[],a=0;a<r;++a){var c=e[a].trim(),l=a;if("("===c)l=u(")",e,a+1,r);else{if(")"===c)throw new Error("invalid format");if(-1<h.indexOf(c))l=u(c,e,a+1,r);else if(c===n){s.length&&(o.push(s.join("")),s=[]);continue}}-1===l&&(l=r-1),s.push(e.slice(a,l+1).join("")),a=l}return s.length&&o.push(s.join("")),o}(t,",")}function D(){return Date.now?Date.now():(new Date).getTime()}function E(t,n,i,e){t.addEventListener(n,i,e)}function C(t,n,i){t.removeEventListener(n,i)}var T=function(){return(T=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function p(t){return 180*(n=[t[0].clientX,t[0].clientY],i=[t[1].clientX,t[1].clientY],e=i[0]-n[0],r=i[1]-n[1],(0<=(o=Math.atan2(r,e))?o:o+2*Math.PI)/Math.PI);var n,i,e,r,o}function g(t,n,i,e){var r=y(t),o=y(n),s=y(e);return X(b(e[0],P(r,s)),b(e[0],P(o,s)),i[0])}function Y(t){return t.touches?m(t.touches):[r(t)]}function X(t,n,i){var e=t.clientX,r=t.clientY;return{clientX:e,clientY:r,deltaX:e-n.clientX,deltaY:r-n.clientY,distX:e-i.clientX,distY:r-i.clientY}}function v(t){return Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))}function d(t,i,e){return t.map(function(t,n){return X(t,i[n],e[n])})}function m(t){for(var n=Math.min(t.length,2),i=[],e=0;e<n;++e)i.push(r(t[e]));return i}function r(t){return{clientX:t.clientX,clientY:t.clientY}}function y(t){return 1===t.length?t[0]:{clientX:(t[0].clientX+t[1].clientX)/2,clientY:(t[0].clientY+t[1].clientY)/2}}function b(t,n){return{clientX:t.clientX+n.clientX,clientY:t.clientY+n.clientY}}function P(t,n){return{clientX:t.clientX-n.clientX,clientY:t.clientY-n.clientY}}var S=["textarea","input"],w=function(){function t(t,n){var y=this;void 0===n&&(n={}),this.options={},this.flag=!1,this.pinchFlag=!1,this.datas={},this.isDrag=!1,this.isPinch=!1,this.isMouse=!1,this.isTouch=!1,this.prevClients=[],this.startClients=[],this.movement=0,this.startPinchClients=[],this.startDistance=0,this.customDist=[0,0],this.targets=[],this.prevTime=0,this.isDouble=!1,this.startRotate=0,this.onDragStart=function(t){if(y.flag||!1!==t.cancelable){var n,i=y.options,e=i.container,r=i.pinchOutside,o=i.dragstart,s=i.preventRightClick,a=i.preventDefault,c=i.checkInput,l=y.isTouch;if(!y.flag){var h=document.activeElement,u=t.target,f=u.tagName.toLowerCase(),p=-1<S.indexOf(f),g=u.isContentEditable;if(p||g){if(c||h===u)return!1;if(h&&g&&h.isContentEditable&&h.contains(u))return!1}else if((a||"touchstart"===t.type)&&h){var v=h.tagName;(h.isContentEditable||-1<S.indexOf(v))&&h.blur()}}if(!y.flag&&l&&r&&setTimeout(function(){E(e,"touchstart",y.onDragStart,{passive:!1})}),y.flag&&l&&r&&C(e,"touchstart",y.onDragStart),(n=t).touches&&2<=n.touches.length){if(!y.flag&&t.touches.length!==t.changedTouches.length)return;y.pinchFlag||y.onPinchStart(t)}if(!y.flag){var d=y.startClients[0]?y.startClients:Y(t);y.customDist=[0,0],y.flag=!0,y.isDrag=!1,y.startClients=d,y.prevClients=d,y.datas={};var m=X(d[y.movement=0],y.prevClients[0],y.startClients[0]);if(s&&(3===t.which||2===t.button))return y.initDrag(),!1;!1===(o&&o(T({type:"dragstart",datas:y.datas,inputEvent:t},m)))&&y.initDrag(),y.isDouble=D()-y.prevTime<200,y.flag&&a&&t.preventDefault()}}},this.onDrag=function(t,n){if(y.flag){var i=Y(t);y.pinchFlag&&y.onPinch(t,i);var e=y.move([0,0],t,i);if(e&&(e.deltaX||e.deltaY)){var r=y.options.drag;r&&r(T({},e,{isScroll:!!n,inputEvent:t}))}}},this.onDragEnd=function(t){if(y.flag){var n=y.options,i=n.dragend,e=n.pinchOutside,r=n.container;y.isTouch&&e&&C(r,"touchstart",y.onDragStart),y.pinchFlag&&y.onPinchEnd(t),y.flag=!1;var o=y.prevClients,s=y.startClients,a=y.pinchFlag?g(o,o,s,y.startPinchClients):X(o[0],o[0],s[0]),c=D(),l=!y.isDrag&&y.isDouble;y.prevTime=y.isDrag||l?0:c,y.startClients=[],y.prevClients=[],i&&i(T({type:"dragend",datas:y.datas,isDouble:l,isDrag:y.isDrag,inputEvent:t},a))}};var i=[].concat(t);this.options=T({checkInput:!1,container:1<i.length?window:i[0],preventRightClick:!0,preventDefault:!0,pinchThreshold:0,events:["touch","mouse"]},n);var e=this.options,r=e.container,o=e.events;if(this.isTouch=-1<o.indexOf("touch"),this.isMouse=-1<o.indexOf("mouse"),this.customDist=[0,0],this.targets=i,this.isMouse&&(i.forEach(function(t){E(t,"mousedown",y.onDragStart)}),E(r,"mousemove",this.onDrag),E(r,"mouseup",this.onDragEnd),E(r,"contextmenu",this.onDragEnd)),this.isTouch){var s={passive:!1};i.forEach(function(t){E(t,"touchstart",y.onDragStart,s)}),E(r,"touchmove",this.onDrag,s),E(r,"touchend",this.onDragEnd,s),E(r,"touchcancel",this.onDragEnd,s)}}var n=t.prototype;return n.isDragging=function(){return this.isDrag},n.isFlag=function(){return this.flag},n.isPinchFlag=function(){return this.pinchFlag},n.isPinching=function(){return this.isPinch},n.scrollBy=function(n,i,t,e){void 0===e&&(e=!0),this.flag&&(this.startClients.forEach(function(t){t.clientX-=n,t.clientY-=i}),this.prevClients.forEach(function(t){t.clientX-=n,t.clientY-=i}),e&&this.onDrag(t,!0))},n.move=function(t,n,i){var e=t[0],r=t[1];void 0===i&&(i=this.prevClients);var o=this.customDist,s=this.prevClients,a=this.startClients,c=this.pinchFlag?g(i,s,a,this.startPinchClients):X(i[0],s[0],a[0]);o[0]+=e,o[1]+=r,c.deltaX+=e,c.deltaY+=r;var l=c.deltaX,h=c.deltaY;return c.distX+=o[0],c.distY+=o[1],this.movement+=Math.sqrt(l*l+h*h),this.prevClients=i,this.isDrag=!0,T({type:"drag",datas:this.datas},c,{movement:this.movement,isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,inputEvent:n})},n.onPinchStart=function(t){var n,i,e=this.options,r=e.pinchstart,o=e.pinchThreshold;if(!(this.isDrag&&this.movement>o)){var s=m(t.changedTouches);if(this.pinchFlag=!0,(n=this.startClients).push.apply(n,s),(i=this.prevClients).push.apply(i,s),this.startDistance=v(this.prevClients),this.startPinchClients=this.prevClients.slice(),r){var a=this.prevClients,c=y(a),l=X(c,c,c);this.startRotate=p(a),r(T({type:"pinchstart",datas:this.datas,angle:this.startRotate,touches:d(a,a,a)},l,{inputEvent:t}))}}},n.onPinch=function(t,n){if(this.flag&&this.pinchFlag&&!(n.length<2)){this.isPinch=!0;var i=this.options.pinch;if(i){var e=this.prevClients,r=this.startClients,o=X(y(n),y(e),y(r)),s=p(n),a=v(n);i(T({type:"pinch",datas:this.datas,movement:this.movement,angle:s,rotation:s-this.startRotate,touches:d(n,e,r),scale:a/this.startDistance,distance:a},o,{inputEvent:t}))}}},n.onPinchEnd=function(t){if(this.flag&&this.pinchFlag){var n=this.isPinch;this.isPinch=!1,this.pinchFlag=!1;var i=this.options.pinchend;if(i){var e=this.prevClients,r=this.startClients,o=X(y(e),y(e),y(r));i(T({type:"pinchend",datas:this.datas,isPinch:n,touches:d(e,e,r)},o,{inputEvent:t})),this.isPinch=!1,this.pinchFlag=!1}}},n.unset=function(){var n=this,t=this.targets,i=this.options.container;this.isMouse&&(t.forEach(function(t){C(t,"mousedown",n.onDragStart)}),C(i,"mousemove",this.onDrag),C(i,"mouseup",this.onDragEnd),C(i,"contextmenu",this.onDragEnd)),this.isTouch&&(t.forEach(function(t){C(t,"touchstart",n.onDragStart)}),C(i,"touchstart",this.onDragStart),C(i,"touchmove",this.onDrag),C(i,"touchend",this.onDragEnd),C(i,"touchcancel",this.onDragEnd))},n.initDrag=function(){this.startClients=[],this.prevClients=[],this.flag=!1},t}();var O,A,_,j,x=(_="rCS"+function(t){for(var n=5381,i=t.length;i;)n=33*n^t.charCodeAt(--i);return n>>>0}(O="\n{\n    position: relative;\n    display: block;\n    overflow: auto;\n}\n:host::-webkit-scrollbar {\n    display: none;\n}\n").toString(36),j=0,{className:_,inject:function(t){var n,i,e,r,o,s=function(t){if(t.getRootNode){var n=t.getRootNode();if(11===n.nodeType)return n}}(t),a=0===j;return(s||a)&&(i=_,e=O,r=s,(o=document.createElement("style")).setAttribute("type","text/css"),o.innerHTML=e.replace(/([^}{]*){/gm,function(t,n){return f(n).map(function(t){return-1<t.indexOf(":global")?t.replace(/\:global/g,""):-1<t.indexOf(":host")?""+t.replace(/\:host/g,"."+i):"."+i+" "+t}).join(", ")+"{"}),(r||document.head||document.body).appendChild(o),n=o),a&&(A=n),s||++j,{destroy:function(){s?(t.removeChild(n),n=null):(0<j&&--j,0===j&&A&&(A.parentNode.removeChild(A),A=null))}}}}),M=x.className,F=["margin","threshold","zoom","rangeX","rangeY","usePinch","pinchThreshold"],n=function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;var e=Array(t),r=0;for(n=0;n<i;n++)for(var o=arguments[n],s=0,a=o.length;s<a;s++,r++)e[r]=o[s];return e}(F,["scrollArea"]),i={margin:Number,threshold:Number,zoom:Number,scrollArea:Object,rangeX:Array,rangeY:Array,pinchThreshold:Number,usePinch:Boolean};function L(t,n){var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return Math.abs(i/n)}function R(t,n,i){return Math.min(i,Math.max(n,t))}var e=function(e){function t(){this.constructor=n}var n,i;function r(t,n,i){void 0===i&&(i={});var E=e.call(this)||this;return E.container=t,E.viewport=n,E.loopX=0,E.loopY=0,E.offsetX=0,E.offsetY=0,E.scrollLeft=0,E.scrollTop=0,E.timer=0,E.dragFlag=!1,E.onScroll=function(){var t=E.container,n=t.scrollLeft,i=t.scrollTop,e=E.margin,r=void 0===e?0:e,o=E.threshold,s=void 0===o?0:o,a=E.loopX,c=E.loopY,l=E.rangeX,h=void 0===l?[0,0]:l,u=E.rangeY,f=void 0===u?[0,0]:u,p=2*r-s,g=a,v=c,d=n,m=i;n<s?g>h[0]&&(d=n+r,--g):p<n&&g<h[1]&&(d=n-r,++g),i<s?v>f[0]&&(m=i+r,--v):p<i&&v<f[1]&&(m=i-r,++v);var y=E.scrollLeft!==d||E.scrollTop!==m,D=a!==g||c!==v;E.scrollLeft=d,E.scrollTop=m,E.loopX=g,E.loopY=v,E.render(),(D||y)&&E.trigger("scroll",{scrollLeft:E.getScrollLeft(),scrollTop:E.getScrollTop()}),y&&E.move(d,m)},E.options=l({margin:500,threshold:100,zoom:1,rangeX:[-1/0,1/0],rangeY:[-1/0,1/0],scrollArea:null,usePinch:!1,pinchThreshold:30},i),E.scrollArea=E.options.scrollArea,E.init(),E}c(n=r,i=e),n.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t);var o,s,a=r.prototype;return a.getContainer=function(){return this.container},a.getViewport=function(){return this.viewport},a.destroy=function(){this.off(),this.dragger.unset(),this.injectResult.destroy(),C(this.container,"scroll",this.onScroll),this.dragger=null,this.injectResult=null,this.container=null,this.options=null},a.getScrollTop=function(t){return(this.scrollTop+(this.loopY-1)*this.margin-this.offsetY+(t?(1-this.rangeY[0])*this.margin:0))/this.zoom},a.getScrollLeft=function(t){return(this.scrollLeft+(this.loopX-1)*this.margin-this.offsetX+(t?(1-this.rangeX[0])*this.margin:0))/this.zoom},a.getScrollWidth=function(){return this.container.offsetWidth+this.margin*(this.rangeX[1]-this.rangeX[0]+2)},a.getScrollHeight=function(){return this.container.offsetHeight+this.margin*(this.rangeY[1]-this.rangeY[0]+2)},a.scrollCenter=function(){var t=this.container,n=t.offsetWidth,i=t.offsetHeight,e=this.viewport,r=e.offsetWidth,o=e.offsetHeight,s=this.zoom,a=-(n-r*s)/2,c=-(i-o*s)/2;return this.scrollTo(a,c)},a.scrollBy=function(t,n){var i=this.zoom;return this.scrollTo(this.getScrollLeft()*i+t,this.getScrollTop()*i+n)},a.scrollTo=function(t,n){var i=this.rangeX,e=void 0===i?[0,0]:i,r=this.rangeY,o=void 0===r?[0,0]:r,s=this.margin,a=void 0===s?0:s;return this.loopX=R(Math.floor((a+t)/a),e[0],e[1]),this.loopY=R(Math.floor((a+n)/a),o[0],o[1]),this.offsetX=(this.loopX-1)*a-t+this.scrollLeft,this.offsetY=(this.loopY-1)*a-n+this.scrollTop,this.render(),this.trigger("scroll",{scrollLeft:this.getScrollLeft(),scrollTop:this.getScrollTop()}),this},a.setZoom=function(t){var n=this.viewport,i=n.offsetWidth,e=n.offsetHeight,r=t-this.zoom;this.options.zoom=t,this.scrollBy(i*r/2,e*r/2),this.render()},a.init=function(){var t,n,e=this,i=this.container;if(n=M,(t=i).classList?t.classList.add(n):t.className+=" "+n,!this.scrollArea){this.scrollArea=document.createElement("div");var r=this.scrollArea;r.style.cssText+="position:absolute;top:0;left:0;",i.insertBefore(r,i.firstChild)}this.injectResult=x.inject(i),this.dragger=new w(i,{container:document.body,events:["touch"],dragstart:function(t){var n=t.inputEvent,i=t.datas;return n.preventDefault(),e.pauseAnimation(),e.dragFlag=!1,i.startEvent=n,e.trigger("dragStart",{inputEvent:n})},drag:function(t){var n=e.options;!n.usePinch||t.isPinch?(e.trigger("drag",{inputEvent:t.inputEvent}),function(t){var n=t.deltaX,i=t.deltaY,e=t.datas,r=Date.now(),o=e.speed;if(!o)return e.speed=[0,0],e.time=r;var s=r-e.time;e.speed=[o[0]/2+n/s,o[1]/2+i/s]}(t),e.scrollBy(-t.deltaX,-t.deltaY)):!e.dragFlag&&t.movement>n.pinchThreshold&&(e.dragFlag=!0,e.trigger("abortPinch",{inputEvent:t.datas.startEvent||t.inputEvent}))},dragend:function(t){e.trigger("dragEnd",{isDrag:t.isDrag,isDouble:t.isDouble,inputEvent:t.inputEvent}),e.startAnimation(t.datas.speed)},pinchstart:function(t){var n=t.inputEvent,i=t.datas;n.preventDefault(),e.pauseAnimation(),i.startZoom=e.zoom},pinch:function(t){e.trigger("pinch",{distance:t.distance,scale:t.scale,zoom:t.datas.startZoom*t.scale,inputEvent:t.inputEvent})}});var o=this.margin;E(i,"scroll",this.onScroll),this.render(),this.move(o,o)},a.render=function(){var t=this,n=t.margin,i=void 0===n?0:n,e=t.loopX,r=t.loopY,o=t.offsetX,s=t.offsetY,a=t.zoom,c=void 0===a?1:a,l="calc(100% + "+2*i+"px)",h=(1-e)*i+o,u=(1-r)*i+s;this.scrollArea.style.cssText+="position:absolute;top:0;left:0;width:"+l+";height:"+l+";",this.viewport.style.cssText="transform-origin: 0 0;transform:translate("+h+"px, "+u+"px) scale("+c+");"},a.move=function(t,n){var i=this.container;i.scrollLeft=t,i.scrollTop=n},a.startAnimation=function(t){var r=this;if(t&&(t[0]||t[1])){var n,i,o=function(t){return 1-Math.pow(1-t,3)},s=L(t,-6e-4),a=(i=L(n=t,-6e-4),[n[0]/2*i,n[1]/2*i]),c=Date.now(),l=c,h=function(){var t=Date.now(),n=t-c;s<n&&(n=s);var i=o(n/s),e=o((l-c)/s);l=t,r.scrollBy(-a[0]*(i-e),-a[1]*(i-e)),s<=n||(r.timer=requestAnimationFrame(h))};this.timer=requestAnimationFrame(h)}},a.pauseAnimation=function(){cancelAnimationFrame(this.timer)},r=function(t,n,i,e){var r,o=arguments.length,s=o<3?n:null===e?e=Object.getOwnPropertyDescriptor(n,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,i,e);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(o<3?r(s):3<o?r(n,i,s):r(n,i))||s);return 3<o&&s&&Object.defineProperty(n,i,s),s}([(o=F,s=function(t,n){var i={enumerable:!0,configurable:!0,get:function(){return this.options[n]}},e=("set "+n).replace(/[\s-_]([a-z])/g,function(t,n){return n.toUpperCase()});t[e]?i.set=function(t){this[e](t)}:i.set=function(t){this.options[n]=t},Object.defineProperty(t,n,i)},function(t){var n=t.prototype;o.forEach(function(t){s(n,t)})})],r)}(t),o={__proto__:null,default:e,OPTIONS:n,OPTION_TYPES:i,PROPERTIES:F,EVENTS:["scroll","abortPinch","dragStart","dragEnd","pinch"],METHODS:["getScrollLeft","getScrollTop","getScrollWidth","getScrollHeight","scrollTo","scrollBy","scrollCenter","getContainer","getViewport"],CLASS_NAME:M};for(var s in o)e[s]=o[s];return e});
//# sourceMappingURL=infinite-viewer.min.js.map
