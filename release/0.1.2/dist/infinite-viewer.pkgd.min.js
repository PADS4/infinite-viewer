/*
Copyright (c) 2019 Daybrush
name: infinite-viewer
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/infinite-viewer.git
version: 0.1.2
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).InfiniteViewer=n()}(this,function(){"use strict";var l=function(t,n){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)};var c=function(){return(c=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function a(t){return void 0===t}var t=function(){var t=function(){function t(){this._eventHandler={},this.options={}}var n=t.prototype;return n.trigger=function(t,n){void 0===n&&(n={});var i=this._eventHandler[t]||[];if(!(0<i.length))return!0;i=i.concat(),n.eventType=t;var e=!1,r=[n],s=0;n.stop=function(){e=!0},n.currentTarget=this;for(var o=arguments.length,a=new Array(2<o?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];for(1<=a.length&&(r=r.concat(a)),s=0;i[s];s++)i[s].apply(this,r);return!e},n.once=function(r,s){if("object"==typeof r&&a(s)){var t,n=r;for(t in n)this.once(t,n[t]);return this}if("string"==typeof r&&"function"==typeof s){var o=this;this.on(r,function t(){for(var n=arguments.length,i=new Array(n),e=0;e<n;e++)i[e]=arguments[e];s.apply(o,i),o.off(r,t)})}return this},n.hasOn=function(t){return!!this._eventHandler[t]},n.on=function(t,n){if("object"==typeof t&&a(n)){var i,e=t;for(i in e)this.on(i,e[i]);return this}if("string"==typeof t&&"function"==typeof n){var r=this._eventHandler[t];a(r)&&(this._eventHandler[t]=[],r=this._eventHandler[t]),r.push(n)}return this},n.off=function(t,n){if(a(t))return this._eventHandler={},this;if(a(n)){if("string"==typeof t)return this._eventHandler[t]=void 0,this;var i,e=t;for(i in e)this.off(i,e[i]);return this}var r,s,o=this._eventHandler[t];if(o)for(r=0;void 0!==(s=o[r]);r++)if(s===n){o=o.splice(r,1);break}return this},t}();return t.VERSION="2.1.2",t}();function h(t,n,i,e){t.addEventListener(n,i,e)}function u(t,n,i){t.removeEventListener(n,i)}var f=function(){return(f=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function p(t,n,i,e){var r=Y(t),s=Y(n),o=Y(e);return v(X(e[0],C(r,o)),X(e[0],C(s,o)),i[0])}function g(t){return t.touches?y(t.touches):[r(t)]}function v(t,n,i){var e=t.clientX,r=t.clientY;return{clientX:e,clientY:r,deltaX:e-n.clientX,deltaY:r-n.clientY,distX:e-i.clientX,distY:r-i.clientY}}function d(t){return Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))}function m(t,i,e){return t.map(function(t,n){return v(t,i[n],e[n])})}function y(t){for(var n=Math.min(t.length,2),i=[],e=0;e<n;++e)i.push(r(t[e]));return i}function r(t){return{clientX:t.clientX,clientY:t.clientY}}function Y(t){return{clientX:(t[0].clientX+t[1].clientX)/2,clientY:(t[0].clientY+t[1].clientY)/2}}function X(t,n){return{clientX:t.clientX+n.clientX,clientY:t.clientY+n.clientY}}function C(t,n){return{clientX:t.clientX-n.clientX,clientY:t.clientY-n.clientY}}var D=function(){function t(t,n){var l=this;void 0===n&&(n={}),this.el=t,this.options={},this.flag=!1,this.pinchFlag=!1,this.datas={},this.isDrag=!1,this.isPinch=!1,this.isMouse=!1,this.isTouch=!1,this.prevClients=[],this.startClients=[],this.movement=0,this.startPinchClients=[],this.startDistance=0,this.customDist=[0,0],this.onDragStart=function(t){if(l.flag||!1!==t.cancelable){if((n=t).touches&&2<=n.touches.length){if(!l.flag&&t.touches.length!==t.changedTouches.length)return;l.pinchFlag||l.onPinchStart(t)}var n;if(!l.flag){var i=l.startClients[0]?l.startClients:g(t);l.customDist=[0,0],l.flag=!0,l.isDrag=!1,l.startClients=i,l.prevClients=i,l.datas={};var e=v(i[l.movement=0],l.prevClients[0],l.startClients[0]),r=l.options,s=r.dragstart,o=r.preventRightClick,a=r.preventDefault;(o&&3===t.which||!1===(s&&s(f({datas:l.datas,inputEvent:t},e))))&&(l.startClients=[],l.prevClients=[],l.flag=!1),l.flag&&a&&t.preventDefault()}}},this.onDrag=function(t,n){if(l.flag){var i=g(t);l.pinchFlag&&l.onPinch(t,i);var e=l.move([0,0],t,i);if(e&&(e.deltaX||e.deltaY)){var r=l.options.drag;r&&r(f({},e,{isScroll:!!n,inputEvent:t}))}}},this.onDragEnd=function(t){if(l.flag){l.pinchFlag&&l.onPinchEnd(t),l.flag=!1;var n=l.options.dragend,i=l.prevClients,e=l.startClients,r=l.pinchFlag?p(i,i,e,l.startPinchClients):v(i[0],i[0],e[0]);l.startClients=[],l.prevClients=[],n&&n(f({datas:l.datas,isDrag:l.isDrag,inputEvent:t},r))}},this.options=f({container:t,preventRightClick:!0,preventDefault:!0,pinchThreshold:0,events:["touch","mouse"]},n);var i=this.options,e=i.container,r=i.events;if(this.isTouch=-1<r.indexOf("touch"),this.isMouse=-1<r.indexOf("mouse"),this.customDist=[0,0],this.isMouse&&(h(t,"mousedown",this.onDragStart),h(e,"mousemove",this.onDrag),h(e,"mouseup",this.onDragEnd)),this.isTouch){var s={passive:!1};h(t,"touchstart",this.onDragStart,s),h(e,"touchmove",this.onDrag,s),h(e,"touchend",this.onDragEnd,s)}}var n=t.prototype;return n.isDragging=function(){return this.isDrag},n.isFlag=function(){return this.flag},n.isPinching=function(){return this.isPinch},n.scrollBy=function(n,i,t,e){void 0===e&&(e=!0),this.flag&&(this.startClients.forEach(function(t){t.clientX-=n,t.clientY-=i}),this.prevClients.forEach(function(t){t.clientX-=n,t.clientY-=i}),e&&this.onDrag(t,!0))},n.move=function(t,n,i){var e=t[0],r=t[1];void 0===i&&(i=this.prevClients);var s=this.customDist,o=this.prevClients,a=this.startClients,l=this.pinchFlag?p(i,o,a,this.startPinchClients):v(i[0],o[0],a[0]);s[0]+=e,s[1]+=r,l.deltaX+=e,l.deltaY+=r;var c=l.deltaX,h=l.deltaY;return l.distX+=s[0],l.distY+=s[1],this.movement+=Math.sqrt(c*c+h*h),this.prevClients=i,this.isDrag=!0,f({datas:this.datas},l,{isScroll:!1,inputEvent:n})},n.onPinchStart=function(t){var n,i,e=this.options,r=e.pinchstart,s=e.pinchThreshold;if(!(this.isDrag&&this.movement>s)){var o=y(t.changedTouches);if(this.pinchFlag=!0,(n=this.startClients).push.apply(n,o),(i=this.prevClients).push.apply(i,o),this.startDistance=d(this.prevClients),this.startPinchClients=this.prevClients.slice(),r){var a=this.prevClients,l=Y(a),c=v(l,l,l);r(f({datas:this.datas,touches:m(a,a,a)},c,{inputEvent:t}))}}},n.onPinch=function(t,n){if(this.flag&&this.pinchFlag){this.isPinch=!0;var i=this.options.pinch;if(i){var e=this.prevClients,r=this.startClients,s=v(Y(n),Y(e),Y(r)),o=d(n);i(f({datas:this.datas,touches:m(n,e,r),scale:o/this.startDistance,distance:o},s,{inputEvent:t}))}}},n.onPinchEnd=function(t){if(this.flag&&this.pinchFlag){var n=this.isPinch;this.isPinch=!1,this.pinchFlag=!1;var i=this.options.pinchend;if(i){var e=this.prevClients,r=this.startClients,s=v(Y(e),Y(e),Y(r));i(f({datas:this.datas,isPinch:n,touches:m(e,e,r)},s,{inputEvent:t})),this.isPinch=!1,this.pinchFlag=!1}}},n.unset=function(){var t=this.el,n=this.options.container;this.isMouse&&(u(t,"mousedown",this.onDragStart),u(n,"mousemove",this.onDrag),u(n,"mouseup",this.onDragEnd)),this.isTouch&&(u(t,"touchstart",this.onDragStart),u(n,"touchmove",this.onDrag),u(n,"touchend",this.onDragEnd))},t}();function s(e,t,n){var i=document.createElement("style");return i.setAttribute("type","text/css"),i.innerHTML=t.replace(/([^}{]*){/gm,function(t,n){return((i=n.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g))?i.map(function(t){return t.trim()}):[]).map(function(t){return-1<t.indexOf(":global")?t.replace(/\:global/g,""):-1<t.indexOf(":host")?""+t.replace(/\:host/g,"."+e):"."+e+" "+t}).join(", ")+"{";var i}),(n||document.head||document.body).appendChild(i),i}var o,T,S,b,E=(S="rCS"+function(t){for(var n=5381,i=t.length;i;)n=33*n^t.charCodeAt(--i);return n>>>0}(o="\n{\n    position: relative;\n    display: block;\n    overflow: auto;\n}\n:host::-webkit-scrollbar {\n    display: none;\n}\n").toString(36),b=0,{className:S,inject:function(t){var n,i=function(t){if(t.getRootNode){var n=t.getRootNode();if(11===n.nodeType)return n}}(t),e=0===b;return(i||e)&&(n=s(S,o,i)),e&&(T=n),i||++b,{destroy:function(){i?(t.removeChild(n),n=null):(0<b&&--b,0===b&&T&&(T.parentNode.removeChild(T),T=null))}}}}),P=E.className,O=["margin","threshold","zoom","rangeX","rangeY"],n={margin:Number,threshold:Number,zoom:Number,scrollArea:Object,rangeX:Array,rangeY:Array};function A(t,n){var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return Math.abs(i/n)}function _(t,n,i){return Math.min(i,Math.max(n,t))}var i=function(e){function t(){this.constructor=n}var n,i;function r(t,n,i){void 0===i&&(i={});var d=e.call(this)||this;return d.container=t,d.viewport=n,d.loopX=0,d.loopY=0,d.offsetX=0,d.offsetY=0,d.scrollLeft=0,d.scrollTop=0,d.timer=0,d.onScroll=function(){var t=d.container,n=t.scrollLeft,i=t.scrollTop,e=d.margin,r=d.threshold,s=d.loopX,o=d.loopY,a=d.rangeX,l=d.rangeY,c=2*e-r,h=s,u=o,f=n,p=i;n<r?h>a[0]&&(f=n+e,--h):c<n&&h<a[1]&&(f=n-e,++h),i<r?u>l[0]&&(p=i+e,--u):c<i&&u>l[1]&&(p=i-e,++u);var g=d.scrollLeft!==f||d.scrollTop!==p,v=s!==h||o!==u;d.scrollLeft=f,d.scrollTop=p,d.loopX=h,d.loopY=u,d.render(),(v||g)&&d.trigger("scroll"),g&&d.move(f,p)},d.options=c({margin:500,threshold:100,zoom:1,rangeX:[-1/0,1/0],rangeY:[-1/0,1/0],scrollArea:null},i),d.scrollArea=d.options.scrollArea,d.init(),d}l(n=r,i=e),n.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t);var s,o,a=r.prototype;return a.destroy=function(){this.off(),this.dragger.unset(),this.injectResult.destroy(),u(this.container,"scroll",this.onScroll),this.dragger=null,this.injectResult=null,this.container=null,this.options=null},a.getScrollTop=function(t){return this.scrollTop+(this.loopY-1)*this.margin-this.offsetY+(t?(1-this.rangeY[0])*this.margin:1)},a.getScrollLeft=function(t){return this.scrollLeft+(this.loopX-1)*this.margin-this.offsetX+(t?(1-this.rangeX[0])*this.margin:0)},a.getScrollWidth=function(){return this.container.offsetWidth+this.margin*(this.rangeX[1]-this.rangeX[0]+2)},a.getScrollHeight=function(){return this.container.offsetHeight+this.margin*(this.rangeY[1]-this.rangeY[0]+2)},a.scrollBy=function(t,n){this.scrollTo(this.getScrollLeft()+t,this.getScrollTop()+n)},a.scrollTo=function(t,n){var i=this.rangeX,e=this.rangeY,r=this.margin;this.loopX=_(Math.floor((r+t)/r),i[0],i[1]),this.loopY=_(Math.floor((r+n)/r),e[0],e[1]),this.offsetX=(this.loopX-1)*r-t+this.scrollLeft,this.offsetY=(this.loopY-1)*r-n+this.scrollTop,this.render(),this.trigger("scroll")},a.init=function(){var t,n,i=this,e=this.container;if(n=P,(t=e).classList?t.classList.add(n):t.className+=" "+n,!this.scrollArea){this.scrollArea=document.createElement("div");var r=this.scrollArea;e.insertBefore(r,e.firstChild)}this.scrollArea.style.cssText+="position:absolute;top:0;left:0;",this.injectResult=E.inject(e),this.dragger=new D(e,{container:document.body,events:["touch"],dragstart:function(t){t.inputEvent.preventDefault(),i.pauseAnimation()},drag:function(t){!function(t){var n=t.deltaX,i=t.deltaY,e=t.datas,r=Date.now(),s=e.speed;if(!s)return e.speed=[0,0],e.time=r;var o=r-e.time;e.speed=[s[0]/2+n/o,s[1]/2+i/o]}(t),i.scrollBy(-t.deltaX,-t.deltaY)},dragend:function(t){i.startAnimation(t.datas.speed)}});var s=this.margin;h(e,"scroll",this.onScroll),this.render(),this.move(s,s)},a.render=function(){var t=this,n=t.margin,i=t.loopX,e=t.loopY,r=t.offsetX,s=t.offsetY,o=t.zoom,a="calc(100% + "+2*n+"px)",l=(1-i)*n+r,c=(1-e)*n+s;this.scrollArea.style.cssText+="width:"+a+";height:"+a+";",this.viewport.style.transform="translate("+l+"px, "+c+"px) scale("+o+")"},a.move=function(t,n){var i=this.container;i.scrollLeft=t,i.scrollTop=n},a.startAnimation=function(t){var r=this;if(t&&(t[0]||t[1])){var n,i,s=function(t){return 1-Math.pow(1-t,3)},o=A(t,-6e-4),a=(i=A(n=t,-6e-4),[n[0]/2*i,n[1]/2*i]),l=Date.now(),c=l,h=function(){var t=Date.now(),n=t-l;o<n&&(n=o);var i=s(n/o),e=s((c-l)/o);c=t,r.scrollBy(-a[0]*(i-e),-a[1]*(i-e)),o<=n||(r.timer=requestAnimationFrame(h))};this.timer=requestAnimationFrame(h)}},a.pauseAnimation=function(){cancelAnimationFrame(this.timer)},r=function(t,n,i,e){var r,s=arguments.length,o=s<3?n:null===e?e=Object.getOwnPropertyDescriptor(n,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,n,i,e);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(o=(s<3?r(o):3<s?r(n,i,o):r(n,i))||o);return 3<s&&o&&Object.defineProperty(n,i,o),o}([(s=O,o=function(t,n){var i={enumerable:!0,configurable:!0,get:function(){return this.options[n]}},e=("set "+n).replace(/[\s-_]([a-z])/g,function(t,n){return n.toUpperCase()});t[e]?i.set=function(t){this[e](t)}:i.set=function(t){this.options[n]=t},Object.defineProperty(t,n,i)},function(t){var n=t.prototype;s.forEach(function(t){o(n,t)})})],r)}(t),e={__proto__:null,default:i,OPTIONS:["margin","threshold","zoom","scrollArea","rangeX","rangeY"],OPTION_TYPES:n,PROPERTIES:O,EVENTS:["scroll"],METHODS:["getScrollLeft","getScrollTop","getScrollWidth","getScrollHeight","scrollTo","scrollBy"],CLASS_NAME:P};for(var w in e)i[w]=e[w];return i});
//# sourceMappingURL=infinite-viewer.pkgd.min.js.map
