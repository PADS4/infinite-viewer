/*
Copyright (c) 2019 Daybrush
name: infinite-viewer
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/infinite-viewer.git
version: 0.1.0
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@egjs/component"),require("@daybrush/drag"),require("framework-utils"),require("@daybrush/utils"),require("css-styled")):"function"==typeof define&&define.amd?define(["@egjs/component","@daybrush/drag","framework-utils","@daybrush/utils","css-styled"],e):(t=t||self).InfiniteViewer=e(t.Component,t.Dragger,t.frameworkUtils,t.utils,t.styled)}(this,function(t,s,l,a,e){"use strict";var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var f=function(){return(f=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};var h=e("\n{\n    position: relative;\n    display: block;\n    overflow: auto;\n}\n:host::-webkit-scrollbar {\n    display: none;\n}\n"),u=h.className,p=["margin","threshold","zoom","rangeX","rangeY"],r={margin:Number,threshold:Number,zoom:Number,scrollArea:Object,rangeX:Array,rangeY:Array};function g(t,e){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return Math.abs(r/e)}var o=function(o){function t(){this.constructor=e}var e,r;function n(t,e,r){void 0===r&&(r={});var m=o.call(this)||this;return m.container=t,m.viewport=e,m.loopX=0,m.loopY=0,m.offsetX=0,m.offsetY=0,m.scrollLeft=0,m.scrollTop=0,m.timer=0,m.onScroll=function(){var t=m.container,e=t.scrollLeft,r=t.scrollTop,o=m.margin,n=m.threshold,i=m.loopX,s=m.loopY,l=m.rangeX,a=m.rangeY,c=2*o-n,f=i,h=s,u=e,p=r;e<n?f>l[0]&&(u=e+o,--f):c<e&&f<l[1]&&(u=e-o,++f),r<n?h>a[0]&&(p=r+o,--h):c<r&&h>a[1]&&(p=r-o,++h);var g=m.scrollLeft!==u||m.scrollTop!==p,d=i!==f||s!==h;m.scrollLeft=u,m.scrollTop=p,m.loopX=f,m.loopY=h,m.render(),(d||g)&&m.trigger("scroll"),g&&m.move(u,p)},m.options=f({margin:500,threshold:100,zoom:1,rangeX:[-1/0,1/0],rangeY:[-1/0,1/0],scrollArea:null},r),m.scrollArea=m.options.scrollArea,m.init(),m}c(e=n,r=o),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t);var i=n.prototype;return i.destroy=function(){this.off(),this.dragger.unset(),this.injectResult.destroy(),a.removeEvent(this.container,"scroll",this.onScroll),this.dragger=null,this.injectResult=null,this.container=null,this.options=null},i.getScrollTop=function(t){return this.scrollTop+(this.loopY-1)*this.margin-this.offsetY+(t?(1-this.rangeY[0])*this.margin:1)},i.getScrollLeft=function(t){return this.scrollLeft+(this.loopX-1)*this.margin-this.offsetX+(t?(1-this.rangeX[0])*this.margin:0)},i.getScrollWidth=function(){return this.container.offsetWidth+this.margin*(this.rangeX[1]-this.rangeX[0]+2)},i.getScrollHeight=function(){return this.container.offsetHeight+this.margin*(this.rangeY[1]-this.rangeY[0]+2)},i.scrollBy=function(t,e){this.scrollTo(this.getScrollLeft()+t,this.getScrollTop()+e)},i.scrollTo=function(t,e){var r=this.margin;this.loopX=Math.floor((r+t)/r),this.loopY=Math.floor((r+e)/r),this.offsetX=(this.loopX-1)*r-t+this.scrollLeft,this.offsetY=(this.loopY-1)*r-e+this.scrollTop,this.render(),this.trigger("scroll")},i.init=function(){var e=this,t=this.container;if(a.addClass(t,u),!this.scrollArea){this.scrollArea=document.createElement("div");var r=this.scrollArea;r.style.cssText="position:absolute;top:0;left:0;width:calc(100% + 400px);height:calc(100% + 400px);",t.insertBefore(r,t.firstChild)}this.injectResult=h.inject(t),this.dragger=new s(t,{container:document.body,events:["touch"],dragstart:function(t){t.inputEvent.preventDefault(),e.pauseAnimation()},drag:function(t){!function(t){var e=t.deltaX,r=t.deltaY,o=t.datas,n=Date.now(),i=o.speed;if(!i)return o.speed=[0,0],o.time=n;var s=n-o.time;o.speed=[i[0]/2+e/s,i[1]/2+r/s]}(t),e.scrollBy(-t.deltaX,-t.deltaY)},dragend:function(t){e.startAnimation(t.datas.speed)}});var o=this.margin;a.addEvent(t,"scroll",this.onScroll),this.render(),this.move(o,o)},i.render=function(){var t=this,e=t.margin,r=t.loopX,o=t.loopY,n=t.offsetX,i=t.offsetY,s=t.zoom,l="calc(100% + "+2*e+"px)",a=(1-r)*e+n,c=(1-o)*e+i;this.scrollArea.style.cssText+="width:"+l+";height:"+l+";",this.viewport.style.transform="translate("+a+"px, "+c+"px) scale("+s+")"},i.move=function(t,e){var r=this.container;r.scrollLeft=t,r.scrollTop=e},i.startAnimation=function(t){var n=this;if(t&&(t[0]||t[1])){var e,r,i=function(t){return 1-Math.pow(1-t,3)},s=g(t,-6e-4),l=(r=g(e=t,-6e-4),[e[0]/2*r,e[1]/2*r]),a=Date.now(),c=a,f=function(){var t=Date.now(),e=t-a;s<e&&(e=s);var r=i(e/s),o=i((c-a)/s);c=t,n.scrollBy(-l[0]*(r-o),-l[1]*(r-o)),s<=e||(n.timer=requestAnimationFrame(f))};this.timer=requestAnimationFrame(f)}},i.pauseAnimation=function(){cancelAnimationFrame(this.timer)},n=function(t,e,r,o){var n,i=arguments.length,s=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,o);else for(var l=t.length-1;0<=l;l--)(n=t[l])&&(s=(i<3?n(s):3<i?n(e,r,s):n(e,r))||s);return 3<i&&s&&Object.defineProperty(e,r,s),s}([l.Properties(p,function(t,e){var r={enumerable:!0,configurable:!0,get:function(){return this.options[e]}},o=a.camelize("set "+e);t[o]?r.set=function(t){this[o](t)}:r.set=function(t){this.options[e]=t},Object.defineProperty(t,e,r)})],n)}(t),n={__proto__:null,default:o,OPTIONS:["margin","threshold","zoom","scrollArea","rangeX","rangeY"],OPTION_TYPES:r,PROPERTIES:p,EVENTS:["scroll"],METHODS:["getScrollLeft","getScrollTop","getScrollWidth","getScrollHeight","scrollTo","scrollBy"],CLASS_NAME:u};for(var i in n)o[i]=n[i];return o});
//# sourceMappingURL=infinite-viewer.min.js.map
